<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="./css/Blinddate.css?cachelib=false">
    <link rel="stylesheet" type="text/css" href="./css/philosopher.css?cachelib=false">
    <link rel="stylesheet" type="text/css" href="./css/main.css?cachelib=false">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="./js/libs/vue.global-3.5.13.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            font-family: var(--body-font);
        }

        #app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        .character-sheet {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Header Section */
        .sheet-header {
            background-color: var(--header-bg);
            color: var(--header-fg);
            padding: 20px;
            border-radius: 8px;
        }

        .character-name {
            font-size: 2em;
            font-weight: bold;
            font-family: var(--header-font);
            margin-bottom: 10px;
        }

        .character-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            font-size: 0.9em;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-weight: bold;
            opacity: 0.8;
            font-size: 0.85em;
            margin-bottom: 2px;
        }

        /* Tab Navigation */
        .tabs-container {
            display: flex;
            gap: 5px;
            border-bottom: 2px solid var(--header-bg);
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            background-color: var(--row-color);
            color: var(--foreground-color);
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: bold;
            transition: all 0.3s;
            position: relative;
            top: 2px;
            font-family: var(--body-font);
        }

        .tab:hover {
            background-color: var(--header-bg);
            color: var(--header-fg);
        }

        .tab.active {
            background-color: var(--header-bg);
            color: var(--header-fg);
            border-bottom: 2px solid var(--header-bg);
        }

        .tab i {
            margin-right: 8px;
        }

        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background-color: var(--row-color);
            border-radius: 0 0 8px 8px;
        }

        /* Ability Scores */
        .abilities-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 900px) {
            .abilities-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .abilities-grid {
                grid-template-columns: 1fr;
            }
        }

        .ability-block {
            background-color: var(--background-color);
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid var(--header-bg);
        }

        .ability-header {
            background-color: var(--header-bg);
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .ability-name {
            font-size: 0.85em;
            font-weight: bold;
            color: var(--header-fg);
            text-transform: uppercase;
        }

        .ability-score-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ability-score {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--header-fg);
        }

        .ability-modifier {
            font-size: 1.1em;
            color: var(--header-fg);
            background-color: rgba(255,255,255,0.2);
            border-radius: 4px;
            padding: 4px 10px;
            font-weight: bold;
        }

        .ability-body {
            padding: 12px;
        }

        .ability-save {
            display: flex;
            align-items: center;
            padding: 8px 10px;
            background-color: var(--row-color);
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .ability-save-label {
            font-size: 0.85em;
            font-weight: bold;
            margin-right: auto;
        }

        .ability-skills-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .ability-skills-title {
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
            opacity: 0.7;
            margin-bottom: 4px;
        }

        /* Skills Section */
        .skills-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .skills-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--header-bg);
        }

        .skills-title {
            font-size: 1.2em;
            font-weight: bold;
        }

        .proficiency-bonus {
            background-color: var(--header-bg);
            color: var(--header-fg);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 8px;
        }

        .skill-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background-color: var(--background-color);
            border-radius: 4px;
            transition: all 0.2s;
        }

        .skill-item:hover {
            transform: translateX(3px);
        }

        .skill-prof {
            width: 18px;
            height: 18px;
            border: 2px solid var(--foreground-color);
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            flex-shrink: 0;
        }

        .skill-prof.proficient {
            background-color: var(--header-bg);
            color: var(--header-fg);
            border-color: var(--header-bg);
        }

        .skill-prof.expert {
            background-color: #ffc107;
            color: #000;
            border-color: #ffc107;
        }

        .skill-name {
            flex: 1;
            font-size: 0.9em;
        }

        .skill-ability {
            font-size: 0.75em;
            opacity: 0.6;
            margin-left: 5px;
        }

        .skill-bonus {
            font-weight: bold;
            min-width: 30px;
            text-align: right;
        }

        /* Saving Throws */
        .saves-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .save-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: var(--background-color);
            border-radius: 4px;
        }

        /* Combat Stats */
        .combat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .combat-box {
            background-color: var(--background-color);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid var(--header-bg);
        }

        .combat-label {
            font-size: 0.85em;
            font-weight: bold;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .combat-value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .hp-container {
            grid-column: span 2;
        }

        @media (max-width: 500px) {
            .hp-container {
                grid-column: span 1;
            }
        }

        .hp-bar-container {
            margin-top: 10px;
            width: 100%;
            height: 10px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            overflow: hidden;
        }

        .hp-bar {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 5px;
        }

        .hp-bar.healthy { background: linear-gradient(90deg, #28a745, #20c997); }
        .hp-bar.injured { background: linear-gradient(90deg, #ffc107, #fd7e14); }
        .hp-bar.critical { background: linear-gradient(90deg, #dc3545, #c82333); }

        .hp-text {
            display: flex;
            justify-content: center;
            gap: 5px;
            font-size: 1.4em;
            font-weight: bold;
        }

        /* Death Saves */
        .death-saves {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }

        .death-save-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .death-save-label {
            font-size: 0.8em;
            margin-right: 5px;
        }

        .death-save-dot {
            width: 16px;
            height: 16px;
            border: 2px solid var(--foreground-color);
            border-radius: 50%;
        }

        .death-save-dot.success.filled { background-color: #28a745; border-color: #28a745; }
        .death-save-dot.failure.filled { background-color: #dc3545; border-color: #dc3545; }

        /* Attacks & Actions */
        .attacks-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .attack-item {
            display: grid;
            grid-template-columns: 2fr 1fr 2fr;
            gap: 15px;
            padding: 12px;
            background-color: var(--background-color);
            border-radius: 4px;
            align-items: center;
        }

        .attack-name {
            font-weight: bold;
        }

        .attack-bonus {
            text-align: center;
            background-color: var(--header-bg);
            color: var(--header-fg);
            padding: 5px 10px;
            border-radius: 4px;
        }

        .attack-damage {
            font-size: 0.9em;
        }

        /* Inventory Section */
        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--header-bg);
        }

        .currency-display {
            display: flex;
            gap: 15px;
        }

        .currency-item {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background-color: var(--background-color);
            border-radius: 4px;
        }

        .currency-icon {
            font-weight: bold;
            width: 20px;
            text-align: center;
        }

        .currency-icon.pp { color: #e5e5e5; }
        .currency-icon.gp { color: #ffd700; }
        .currency-icon.ep { color: #c0c0c0; }
        .currency-icon.sp { color: #a0a0a0; }
        .currency-icon.cp { color: #b87333; }

        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
        }

        .equipment-item {
            padding: 12px;
            background-color: var(--background-color);
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .equipment-info {
            flex: 1;
        }

        .equipment-name {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .equipment-details {
            font-size: 0.85em;
            opacity: 0.7;
        }

        .equipment-quantity {
            background-color: var(--header-bg);
            color: var(--header-fg);
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85em;
        }

        /* Spells Section */
        .spellcasting-header {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .spell-stat-box {
            background-color: var(--background-color);
            padding: 12px;
            border-radius: 4px;
            text-align: center;
            border: 2px solid var(--header-bg);
        }

        .spell-stat-label {
            font-size: 0.8em;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .spell-stat-value {
            font-size: 1.5em;
            font-weight: bold;
        }

        .spell-levels-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .spell-level-section {
            background-color: var(--background-color);
            padding: 15px;
            border-radius: 4px;
        }

        .spell-level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--header-bg);
        }

        .spell-level-title {
            font-weight: bold;
        }

        .spell-slots {
            display: flex;
            gap: 5px;
        }

        .spell-slot {
            width: 20px;
            height: 20px;
            border: 2px solid var(--header-bg);
            border-radius: 50%;
        }

        .spell-slot.used {
            background-color: var(--header-bg);
        }

        .spell-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 8px;
        }

        .spell-item {
            padding: 8px 12px;
            background-color: var(--row-color);
            border-radius: 4px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .spell-item:hover {
            transform: translateX(3px);
            background-color: var(--header-bg);
            color: var(--header-fg);
        }

        .spell-item.prepared {
            border-left: 3px solid var(--header-bg);
        }

        .spell-name {
            font-weight: bold;
            font-size: 0.9em;
        }

        .spell-meta {
            font-size: 0.8em;
            opacity: 0.7;
            margin-top: 2px;
        }

        /* Features & Traits */
        .features-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .feature-category {
            margin-bottom: 15px;
        }

        .feature-category-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--header-bg);
        }

        .features-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .feature-item {
            background-color: var(--background-color);
            padding: 12px;
            border-radius: 4px;
        }

        .feature-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .feature-name {
            font-weight: bold;
        }

        .feature-source {
            font-size: 0.8em;
            opacity: 0.6;
        }

        .feature-description {
            font-size: 0.9em;
            line-height: 1.5;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--row-color);
        }

        .feature-toggle {
            transition: transform 0.3s;
        }

        .feature-toggle.expanded {
            transform: rotate(180deg);
        }

        /* Notes Section */
        .notes-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .notes-section {
            background-color: var(--background-color);
            padding: 15px;
            border-radius: 4px;
        }

        .notes-title {
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--header-bg);
        }

        .notes-textarea {
            width: 100%;
            min-height: 120px;
            background-color: var(--row-color);
            color: var(--foreground-color);
            border: 1px solid var(--header-bg);
            border-radius: 4px;
            padding: 10px;
            font-family: inherit;
            font-size: 0.9em;
            resize: vertical;
            box-sizing: border-box;
        }

        /* Collapsible Sections (Alternative to Tabs) */
        .collapsible-section {
            margin-bottom: 10px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background-color: var(--header-bg);
            color: var(--header-fg);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .section-header:hover {
            opacity: 0.9;
        }

        .section-header.expanded {
            border-radius: 8px 8px 0 0;
        }

        .section-title {
            font-weight: bold;
            font-size: 1.1em;
        }

        .section-title i {
            margin-right: 10px;
        }

        .section-toggle {
            transition: transform 0.3s;
        }

        .section-toggle.expanded {
            transform: rotate(180deg);
        }

        .section-content {
            background-color: var(--row-color);
            padding: 15px;
            border-radius: 0 0 8px 8px;
        }

        /* Utility Classes */
        .section-divider {
            height: 2px;
            background-color: var(--header-bg);
            margin: 20px 0;
        }

        .subsection-title {
            font-weight: bold;
            font-size: 1em;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--header-bg);
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="character-sheet">
            <!-- Character Header -->
            <div class="sheet-header">
                <div class="character-name">{{ character.name }}</div>
                <div class="character-info">
                    <div class="info-item">
                        <span class="info-label">Race</span>
                        <span>{{ character.race }} {{ character.subrace }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Class</span>
                        <span>{{ characterClass }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Level</span>
                        <span>{{ character.level }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Background</span>
                        <span>{{ character.background }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Alignment</span>
                        <span>{{ character.alignment }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Experience</span>
                        <span>{{ character.experiencePoints }} XP</span>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="tabs-container">
                <button 
                    v-for="tab in tabs" 
                    :key="tab.id"
                    class="tab"
                    :class="{ active: activeTab === tab.id }"
                    @click="activeTab = tab.id">
                    <i :class="tab.icon"></i>{{ tab.label }}
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                
                <!-- Abilities & Skills Tab -->
                <div v-show="activeTab === 'abilities'">
                    <!-- Proficiency Bonus Header -->
                    <div class="skills-header" style="margin-bottom: 15px;">
                        <div class="skills-title">Abilities, Saves & Skills</div>
                        <div class="proficiency-bonus">Proficiency: {{ formatModifier(character.proficiencyBonus) }}</div>
                    </div>

                    <!-- Ability Blocks -->
                    <div class="abilities-grid">
                        <div class="ability-block" v-for="(score, ability) in character.abilities" :key="ability">
                            <!-- Ability Header with Score and Modifier -->
                            <div class="ability-header">
                                <div class="ability-name">{{ abilityNames[ability] || ability }}</div>
                                <div class="ability-score-group">
                                    <div class="ability-score">{{ score }}</div>
                                    <div class="ability-modifier">{{ formatModifier(getModifier(score)) }}</div>
                                </div>
                            </div>

                            <!-- Ability Body with Save and Skills -->
                            <div class="ability-body">
                                <!-- Saving Throw -->
                                <div class="ability-save">
                                    <span class="skill-prof" :class="{ proficient: character.savingThrows[ability]?.proficient }">
                                        <i v-if="character.savingThrows[ability]?.proficient" class="fas fa-check"></i>
                                    </span>
                                    <span class="ability-save-label">Saving Throw</span>
                                    <span class="skill-bonus">{{ formatModifier(getSaveBonus(ability)) }}</span>
                                </div>

                                <!-- Related Skills -->
                                <div class="ability-skills-list" v-if="getSkillsByAbility(ability).length > 0">
                                    <div class="ability-skills-title">Skills</div>
                                    <div class="skill-item" v-for="skillName in getSkillsByAbility(ability)" :key="skillName">
                                        <span class="skill-prof" :class="{ proficient: character.skills[skillName].proficient, expert: character.skills[skillName].expertise }">
                                            <i v-if="character.skills[skillName].proficient && !character.skills[skillName].expertise" class="fas fa-check"></i>
                                            <span v-if="character.skills[skillName].expertise">E</span>
                                        </span>
                                        <span class="skill-name">{{ skillName }}</span>
                                        <span class="skill-bonus">{{ formatModifier(getSkillBonus(skillName)) }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Combat Tab -->
                <div v-show="activeTab === 'combat'">
                    <div class="combat-grid">
                        <div class="combat-box">
                            <div class="combat-label">Armor Class</div>
                            <div class="combat-value">{{ character.combat.armorClass }}</div>
                        </div>
                        <div class="combat-box">
                            <div class="combat-label">Initiative</div>
                            <div class="combat-value">{{ formatModifier(character.combat.initiative) }}</div>
                        </div>
                        <div class="combat-box">
                            <div class="combat-label">Speed</div>
                            <div class="combat-value">{{ character.combat.speed }} ft</div>
                        </div>
                        <div class="combat-box hp-container">
                            <div class="combat-label">Hit Points</div>
                            <div class="hp-text">
                                <span>{{ character.combat.currentHp }}</span>
                                <span>/</span>
                                <span>{{ character.combat.maxHp }}</span>
                            </div>
                            <div v-if="character.combat.tempHp > 0" style="font-size: 0.9em; opacity: 0.8;">
                                (+{{ character.combat.tempHp }} temp)
                            </div>
                            <div class="hp-bar-container">
                                <div class="hp-bar" :class="hpStatus" :style="{ width: hpPercentage + '%' }"></div>
                            </div>
                        </div>
                        <div class="combat-box">
                            <div class="combat-label">Hit Dice</div>
                            <div class="combat-value" style="font-size: 1.2em;">{{ character.combat.hitDice }}</div>
                        </div>
                        <div class="combat-box">
                            <div class="combat-label">Death Saves</div>
                            <div class="death-saves">
                                <div class="death-save-group">
                                    <span class="death-save-label"><i class="fas fa-check"></i></span>
                                    <span v-for="n in 3" :key="'s'+n" 
                                          class="death-save-dot success"
                                          :class="{ filled: n <= character.combat.deathSaves.successes }"></span>
                                </div>
                                <div class="death-save-group">
                                    <span class="death-save-label"><i class="fas fa-times"></i></span>
                                    <span v-for="n in 3" :key="'f'+n" 
                                          class="death-save-dot failure"
                                          :class="{ filled: n <= character.combat.deathSaves.failures }"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <!-- Attacks -->
                    <div class="subsection-title">Attacks & Actions</div>
                    <div class="attacks-list">
                        <div class="attack-item" v-for="attack in character.attacks" :key="attack.name">
                            <div class="attack-name">{{ attack.name }}</div>
                            <div class="attack-bonus">{{ formatModifier(attack.attackBonus) }}</div>
                            <div class="attack-damage">{{ attack.damage }} {{ attack.damageType }}</div>
                        </div>
                    </div>
                </div>

                <!-- Spells Tab -->
                <div v-show="activeTab === 'spells'">
                    <template v-if="character.spellcasting">
                        <div class="spellcasting-header">
                            <div class="spell-stat-box">
                                <div class="spell-stat-label">Spellcasting Ability</div>
                                <div class="spell-stat-value">{{ character.spellcasting.ability }}</div>
                            </div>
                            <div class="spell-stat-box">
                                <div class="spell-stat-label">Spell Save DC</div>
                                <div class="spell-stat-value">{{ character.spellcasting.saveDC }}</div>
                            </div>
                            <div class="spell-stat-box">
                                <div class="spell-stat-label">Spell Attack</div>
                                <div class="spell-stat-value">{{ formatModifier(character.spellcasting.attackBonus) }}</div>
                            </div>
                        </div>

                        <div class="spell-levels-container">
                            <div class="spell-level-section" v-for="(level, index) in spellLevels" :key="index">
                                <div class="spell-level-header">
                                    <div class="spell-level-title">{{ level.name }}</div>
                                    <div class="spell-slots" v-if="level.slots !== undefined">
                                        <span v-for="n in level.slots" :key="n" 
                                              class="spell-slot"
                                              :class="{ used: n <= level.slotsUsed }"></span>
                                    </div>
                                </div>
                                <div class="spell-list">
                                    <div class="spell-item" 
                                         v-for="spell in level.spells" 
                                         :key="spell.name"
                                         :class="{ prepared: spell.prepared }">
                                        <div class="spell-name">{{ spell.name }}</div>
                                        <div class="spell-meta">{{ spell.school }} Â· {{ spell.castingTime }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                    <template v-else>
                        <div style="text-align: center; padding: 40px; opacity: 0.7;">
                            <i class="fas fa-magic" style="font-size: 3em; margin-bottom: 15px;"></i>
                            <p>This character cannot cast spells.</p>
                        </div>
                    </template>
                </div>

                <!-- Inventory Tab -->
                <div v-show="activeTab === 'inventory'">
                    <div class="inventory-header">
                        <div class="subsection-title" style="margin: 0; border: none; padding: 0;">Equipment</div>
                        <div class="currency-display">
                            <div class="currency-item" v-for="(amount, type) in character.currency" :key="type">
                                <span class="currency-icon" :class="type.toLowerCase()">{{ type }}</span>
                                <span>{{ amount }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="equipment-grid">
                        <div class="equipment-item" v-for="item in character.equipment" :key="item.name">
                            <div class="equipment-info">
                                <div class="equipment-name">{{ item.name }}</div>
                                <div class="equipment-details">{{ item.description }}</div>
                            </div>
                            <div class="equipment-quantity" v-if="item.quantity > 1">x{{ item.quantity }}</div>
                        </div>
                    </div>
                </div>

                <!-- Features Tab -->
                <div v-show="activeTab === 'features'">
                    <div class="features-container">
                        <!-- Racial Traits -->
                        <div class="feature-category" v-if="racialTraits.length > 0">
                            <div class="feature-category-title">Racial Traits</div>
                            <div class="features-list">
                                <div class="feature-item" v-for="feature in racialTraits" :key="feature.name">
                                    <div class="feature-header" @click="toggleFeature(feature)">
                                        <span class="feature-name">{{ feature.name }}</span>
                                        <i class="fas fa-chevron-down feature-toggle" :class="{ expanded: feature.expanded }"></i>
                                    </div>
                                    <div class="feature-description" v-show="feature.expanded">
                                        {{ feature.description }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Class Features -->
                        <div class="feature-category" v-if="classFeatures.length > 0">
                            <div class="feature-category-title">Class Features</div>
                            <div class="features-list">
                                <div class="feature-item" v-for="feature in classFeatures" :key="feature.name">
                                    <div class="feature-header" @click="toggleFeature(feature)">
                                        <div>
                                            <span class="feature-name">{{ feature.name }}</span>
                                            <span class="feature-source">(Level {{ feature.level }})</span>
                                        </div>
                                        <i class="fas fa-chevron-down feature-toggle" :class="{ expanded: feature.expanded }"></i>
                                    </div>
                                    <div class="feature-description" v-show="feature.expanded">
                                        {{ feature.description }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Feats -->
                        <div class="feature-category" v-if="character.feats && character.feats.length > 0">
                            <div class="feature-category-title">Feats</div>
                            <div class="features-list">
                                <div class="feature-item" v-for="feat in character.feats" :key="feat.name">
                                    <div class="feature-header" @click="toggleFeature(feat)">
                                        <span class="feature-name">{{ feat.name }}</span>
                                        <i class="fas fa-chevron-down feature-toggle" :class="{ expanded: feat.expanded }"></i>
                                    </div>
                                    <div class="feature-description" v-show="feat.expanded">
                                        {{ feat.description }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notes Tab -->
                <div v-show="activeTab === 'notes'">
                    <div class="notes-container">
                        <div class="notes-section">
                            <div class="notes-title">Personality Traits</div>
                            <div>{{ character.personality.traits }}</div>
                        </div>
                        <div class="notes-section">
                            <div class="notes-title">Ideals</div>
                            <div>{{ character.personality.ideals }}</div>
                        </div>
                        <div class="notes-section">
                            <div class="notes-title">Bonds</div>
                            <div>{{ character.personality.bonds }}</div>
                        </div>
                        <div class="notes-section">
                            <div class="notes-title">Flaws</div>
                            <div>{{ character.personality.flaws }}</div>
                        </div>
                        <div class="notes-section">
                            <div class="notes-title">Backstory</div>
                            <div>{{ character.backstory }}</div>
                        </div>
                        <div class="notes-section">
                            <div class="notes-title">Notes</div>
                            <textarea class="notes-textarea" v-model="character.notes" placeholder="Additional notes..."></textarea>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        "use strict";

        const { createApp } = Vue;

        const app = createApp({
            data() {
                return {
                    activeTab: 'abilities',
                    tabs: [
                        { id: 'abilities', label: 'Abilities', icon: 'fas fa-dice-d20' },
                        { id: 'combat', label: 'Combat', icon: 'fas fa-shield-alt' },
                        { id: 'spells', label: 'Spells', icon: 'fas fa-hat-wizard' },
                        { id: 'inventory', label: 'Inventory', icon: 'fas fa-backpack' },
                        { id: 'features', label: 'Features', icon: 'fas fa-star' },
                        { id: 'notes', label: 'Notes', icon: 'fas fa-scroll' }
                    ],
                    abilityNames: {
                        STR: 'Strength',
                        DEX: 'Dexterity',
                        CON: 'Constitution',
                        INT: 'Intelligence',
                        WIS: 'Wisdom',
                        CHA: 'Charisma'
                    },
                    character: {
                        name: "Zyr Blackthorne",
                        race: "Half Elf",
                        subrace: "",
                        classes: [
                            { name: "Paladin", subclass: "Oathbreaker", level: 6 },
                            { name: "Wizard", subclass: "Necromancy", level: 4 }
                        ],
                        level: 10,
                        background: "Knight",
                        alignment: "Neutral",
                        experiencePoints: 26500,
                        proficiencyBonus: 3,

                        abilities: {
                            STR: 8,
                            DEX: 14,
                            CON: 13,
                            INT: 18,
                            WIS: 12,
                            CHA: 10
                        },

                        savingThrows: {
                            STR: { proficient: false },
                            DEX: { proficient: false },
                            CON: { proficient: false },
                            INT: { proficient: true },
                            WIS: { proficient: true },
                            CHA: { proficient: false }
                        },

                        skills: {
                            "Acrobatics": { ability: "DEX", proficient: false, expertise: false },
                            "Animal Handling": { ability: "WIS", proficient: false, expertise: false },
                            "Arcana": { ability: "INT", proficient: true, expertise: false },
                            "Athletics": { ability: "STR", proficient: false, expertise: false },
                            "Deception": { ability: "CHA", proficient: false, expertise: false },
                            "History": { ability: "INT", proficient: true, expertise: false },
                            "Insight": { ability: "WIS", proficient: false, expertise: false },
                            "Intimidation": { ability: "CHA", proficient: false, expertise: true },
                            "Investigation": { ability: "INT", proficient: true, expertise: false },
                            "Medicine": { ability: "WIS", proficient: false, expertise: false },
                            "Nature": { ability: "INT", proficient: false, expertise: false },
                            "Perception": { ability: "WIS", proficient: true, expertise: false },
                            "Performance": { ability: "CHA", proficient: false, expertise: false },
                            "Persuasion": { ability: "CHA", proficient: false, expertise: false },
                            "Religion": { ability: "INT", proficient: false, expertise: false },
                            "Sleight of Hand": { ability: "DEX", proficient: false, expertise: false },
                            "Stealth": { ability: "DEX", proficient: false, expertise: false },
                            "Survival": { ability: "WIS", proficient: false, expertise: false }
                        },

                        combat: {
                            armorClass: 12,
                            initiative: 2,
                            speed: 30,
                            maxHp: 71,
                            currentHp: 71,
                            tempHp: 0,
                            hitDice: "6d1+4d6",
                            deathSaves: {
                                successes: 0,
                                failures: 0
                            }
                        },

                        attacks: [
                            { name: "Fire Bolt", attackBonus: 7, damage: "2d10", damageType: "fire" },
                            { name: "Dagger", attackBonus: 5, damage: "1d4+2", damageType: "piercing" },
                            { name: "Quarterstaff", attackBonus: 2, damage: "1d6-1", damageType: "bludgeoning" }
                        ],

                        spellcasting: {
                            ability: "INT",
                            saveDC: 15,
                            attackBonus: 7
                        },

                        spells: {
                            cantrips: [
                                { name: "Fire Bolt", school: "Evocation", castingTime: "1 action", prepared: true },
                                { name: "Light", school: "Evocation", castingTime: "1 action", prepared: true },
                                { name: "Mage Hand", school: "Conjuration", castingTime: "1 action", prepared: true },
                                { name: "Prestidigitation", school: "Transmutation", castingTime: "1 action", prepared: true }
                            ],
                            1: {
                                slots: 4, slotsUsed: 1,
                                spells: [
                                    { name: "Magic Missile", school: "Evocation", castingTime: "1 action", prepared: true },
                                    { name: "Shield", school: "Abjuration", castingTime: "1 reaction", prepared: true },
                                    { name: "Mage Armor", school: "Abjuration", castingTime: "1 action", prepared: true },
                                    { name: "Detect Magic", school: "Divination", castingTime: "1 action", prepared: false },
                                    { name: "Sleep", school: "Enchantment", castingTime: "1 action", prepared: false }
                                ]
                            },
                            2: {
                                slots: 3, slotsUsed: 0,
                                spells: [
                                    { name: "Scorching Ray", school: "Evocation", castingTime: "1 action", prepared: true },
                                    { name: "Misty Step", school: "Conjuration", castingTime: "1 bonus action", prepared: true },
                                    { name: "Hold Person", school: "Enchantment", castingTime: "1 action", prepared: false }
                                ]
                            },
                            3: {
                                slots: 2, slotsUsed: 0,
                                spells: [
                                    { name: "Fireball", school: "Evocation", castingTime: "1 action", prepared: true },
                                    { name: "Counterspell", school: "Abjuration", castingTime: "1 reaction", prepared: true }
                                ]
                            }
                        },

                        currency: {
                            PP: 0,
                            GP: 127,
                            EP: 0,
                            SP: 15,
                            CP: 42
                        },

                        equipment: [
                            { name: "Spellbook", description: "Contains all known spells", quantity: 1 },
                            { name: "Component Pouch", description: "Arcane components", quantity: 1 },
                            { name: "Quarterstaff", description: "Arcane focus", quantity: 1 },
                            { name: "Dagger", description: "1d4 piercing", quantity: 2 },
                            { name: "Scholar's Pack", description: "Includes books, ink, parchment", quantity: 1 },
                            { name: "Robes", description: "Fine wizard robes", quantity: 1 },
                            { name: "Potion of Healing", description: "Heals 2d4+2 HP", quantity: 2 },
                            { name: "Rations", description: "1 day", quantity: 5 }
                        ],

                        features: [
                            { name: "Darkvision", source: "racial", description: "You can see in dim light within 60 feet of you as if it were bright light, and in darkness as if it were dim light.", expanded: false },
                            { name: "Fey Ancestry", source: "racial", description: "You have advantage on saving throws against being charmed, and magic can't put you to sleep.", expanded: false },
                            { name: "Trance", source: "racial", description: "Elves don't need to sleep. Instead, they meditate deeply for 4 hours a day.", expanded: false },
                            { name: "Arcane Recovery", source: "class", level: 1, description: "Once per day when you finish a short rest, you can choose expended spell slots to recover. The spell slots can have a combined level equal to or less than half your wizard level (rounded up).", expanded: false },
                            { name: "Evocation Savant", source: "class", level: 2, description: "The gold and time you must spend to copy an evocation spell into your spellbook is halved.", expanded: false },
                            { name: "Sculpt Spells", source: "class", level: 2, description: "When you cast an evocation spell that affects other creatures, you can choose a number of them equal to 1 + the spell's level. Those creatures automatically succeed on their saving throws and take no damage.", expanded: false },
                            { name: "Potent Cantrip", source: "class", level: 6, description: "Your damaging cantrips affect even creatures that avoid the brunt of the effect. When a creature succeeds on a saving throw against your cantrip, the creature takes half the cantrip's damage but suffers no additional effect.", expanded: false }
                        ],

                        feats: [
                            { name: "War Caster", description: "You have advantage on Constitution saving throws to maintain concentration. You can perform somatic components even with weapons or shield in hands. You can cast a spell as an opportunity attack.", expanded: false }
                        ],

                        personality: {
                            traits: "I use polysyllabic words that convey the impression of great erudition. I've read every book in the world's greatest libraries.",
                            ideals: "Knowledge. The path to power and self-improvement is through knowledge.",
                            bonds: "I have an ancient text that holds terrible secrets that must not fall into the wrong hands.",
                            flaws: "Most people scream and run when they see a demon. I stop and take notes on its anatomy."
                        },

                        backstory: "Thalion spent decades in the great elven libraries, mastering the arcane arts. When dark forces threatened his homeland, he left his studies to put his knowledge to practical use.",

                        notes: ""
                    }
                };
            },

            computed: {
                characterClass() {
                    return this.character.classes
                        .map(c => `${c.name} (${c.subclass}) ${c.level}`)
                        .join(' / ');
                },

                hpPercentage() {
                    return (this.character.combat.currentHp / this.character.combat.maxHp) * 100;
                },

                hpStatus() {
                    const pct = this.hpPercentage;
                    if (pct > 50) return 'healthy';
                    if (pct > 25) return 'injured';
                    return 'critical';
                },

                spellLevels() {
                    const levels = [];
                    
                    // Cantrips
                    if (this.character.spells.cantrips && this.character.spells.cantrips.length > 0) {
                        levels.push({
                            name: 'Cantrips',
                            spells: this.character.spells.cantrips
                        });
                    }

                    // Spell levels 1-9
                    for (let i = 1; i <= 9; i++) {
                        const levelData = this.character.spells[i];
                        if (levelData && levelData.spells && levelData.spells.length > 0) {
                            levels.push({
                                name: `Level ${i}`,
                                slots: levelData.slots,
                                slotsUsed: levelData.slotsUsed || 0,
                                spells: levelData.spells
                            });
                        }
                    }

                    return levels;
                },

                racialTraits() {
                    return this.character.features.filter(f => f.source === 'racial');
                },

                classFeatures() {
                    return this.character.features.filter(f => f.source === 'class');
                }
            },

            methods: {
                getModifier(score) {
                    return Math.floor((score - 10) / 2);
                },

                formatModifier(mod) {
                    return mod >= 0 ? `+${mod}` : `${mod}`;
                },

                getSaveBonus(ability) {
                    const mod = this.getModifier(this.character.abilities[ability]);
                    const proficient = this.character.savingThrows[ability]?.proficient || false;
                    return mod + (proficient ? this.character.proficiencyBonus : 0);
                },

                getSkillBonus(skillName) {
                    const skill = this.character.skills[skillName];
                    if (!skill) return 0;
                    
                    const mod = this.getModifier(this.character.abilities[skill.ability]);
                    let bonus = mod;
                    
                    if (skill.proficient) {
                        bonus += this.character.proficiencyBonus;
                    }
                    if (skill.expertise) {
                        bonus += this.character.proficiencyBonus; // Double proficiency for expertise
                    }
                    
                    return bonus;
                },

                getSkillsByAbility(ability) {
                    return Object.keys(this.character.skills)
                        .filter(skillName => this.character.skills[skillName].ability === ability)
                        .sort();
                },

                toggleFeature(feature) {
                    feature.expanded = !feature.expanded;
                }
            }
        });

        app.mount('#app');
    </script>
</body>

</html>
